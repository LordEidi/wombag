language: go
sudo: false

go:
  - "1.11"

env:
  global:
    - VERSION=$(cat VERSION)

# Skip the install step. Don't `go get` dependencies. Only build with the code
# in vendor/
#install: true

# email me the results of the test runs.
notifications:
  email: true

before_install:
  - cd
  - go get -u -v github.com/spf13/viper
  - go get -u -v github.com/spf13/cobra
  - go get -u -v github.com/PuerkitoBio/goquery
  - go get -u -v github.com/gorilla/schema
  - go get -u -v gopkg.in/go-playground/validator.v9

# Anything in before_script that returns a nonzero exit code will flunk the
# build and immediately stop. It's sorta like having set -e enabled in bash.
# Make sure golangci-lint is vendored by running
#   dep ensure -add github.com/golangci/golangci-lint/cmd/golangci-lint
# ...and adding this to your Gopkg.toml file.
#   required = ["github.com/golangci/golangci-lint/cmd/golangci-lint"]
#
# before_script:
# - go install ./vendor/github.com/golangci/golangci-lint/cmd/golangci-lint

install:
  - go get -u -v github.com/sirupsen/logrus

script:
  - cd $HOME/gopath/src/github.com/LordEidi/wombag
  - mkdir build

  - GOPATH="$HOME/gopath/src/github.com/LordEidi/wombag:/home/travis/gopath"
  - go build -o build/wombagd-v$VERSION -gcflags "all=-N -l" swordlord.com/wombagd
  - go build -o build/wombagcli-v$VERSION -gcflags "all=-N -l" swordlord.com/wombagcli
#  - make
#  go test -v swordlord.com/wombag

# With this configuration the build itself runs for every commit and PR
# (which is nice, because we see if everything compiles fine), but the
# deployment only happens when we actually push a tag as well containing
# the version number of the new release.
#
# deploy:
#   provider: releases
#   skip_cleanup: true # Important, otherwise the build output would be purged.
#   api_key:
#     secure: lFGBaF...SJ1lDPDICY=
#   file: bin/myawesomeapp
#   on:
#     repo: account/myawesomeproject
#     tags: true # The deployment happens only if the commit has a tag.

deploy:
  provider: releases
  file:
    - build/wombagd-v$VERSION
    - build/wombagcli-v$VERSION
  api_key:
    secure: gXF/HUfeHylTjBdjb6NR7/R4k6IaH3jP0I+Ffox1lhU47pAxQXbcS+9BONsw8Vg4boa39wj7DenHY8EJbF4i8gY7WQ+Q71FP6K1cuBvBMqOx3JjW0hLaYcPoWJPkffzPqqWtPopAYzyY9xZKu/IBZr/pJjzG5v1+ml0hhngYyPuoBVxFhkW/IeEZD9f5SG5hWKp3pTro8QBp3uK2fqTNsSwx1c9JgsvKIedGJV0a4Z0m7CM6OhD3/kJAHNJ56HBT4PI9bHXzptL86IVXXmr6X4AUdh9E6OsGqDnkLbFo9MOP9HzSWaa6beYZewwcLdNsSs6B+3qfVkB+d98hmsR+UQoqi0/ON5kiykPiKf8SETXrxnyGwPNuRtBUMIoVol6zNHxQiAMMgVAXRa9AJaZFH2sOn676xZuEwXpDD/H4YiyD9eTC4OHKPDRVNQe+JaWhqwmpxXMpmCsCj/ZJIsFzVD6bagHHA724CzCBbNPxHOYSduXKxDQ++BZ/XRTRMisrueuiUVgMIwYj+23p9FqWqzswtOyceoJjw5ELuL3dXWeGDCBodiIcthF5xxdjwsqB5BBrgyQp9gAYNJcztynXP5Zb4Oum1zq+Siv/rBhJrRw2bfxAZIWGQB1Uyfnf4SMSresMnayI4OnB3rQgURLM4uWsx8LkRx1xCeAQ8aBRGQ0=
  skip_cleanup: true
  on:
    tags: false
